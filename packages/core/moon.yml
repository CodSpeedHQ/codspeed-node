tasks:
  clean:
    args:
      - build
      - generated/openapi
  build:
    deps:
      - build-native-addon
      - build-tracer-client

  build-native-addon-x64:
    command: prebuildify --napi --strip --arch x64

  build-native-addon-arm64:
    command: prebuildify --napi --strip --arch arm64

  build-native-addon:
    deps:
      - build-native-addon-x64
      - build-native-addon-arm64
    command: noop
    inputs:
      - "src/native_core/**/*.cc"
      - "src/native_core/**/*.c"
      - "src/native_core/**/*.h"
      - "binding.gyp"
    outputs:
      - "prebuilds"
    options:
      # Prebuildify can only build one target at a time
      runDepsInParallel: false

  build-tracer-client:
    inputs:
      - "./tracer.spec.json"
    outputs:
      - "src/generated/openapi"
    command: openapi --client axios --input ./tracer.spec.json --name MongoTracer --output ./src/generated/openapi

  typecheck:
    deps:
      - build-tracer-client

  lint:
    deps:
      - build-tracer-client
